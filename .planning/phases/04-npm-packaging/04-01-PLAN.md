---
phase: 04-npm-packaging
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - turbo.json
  - tsconfig.json
  - .gitignore
autonomous: true
requirements: [DX-02, DX-03, DX-04]

must_haves:
  truths:
    - "Root package.json defines private workspaces with packages/* glob"
    - "turbo.json defines build/dev/test/lint tasks with correct dependency declarations"
    - "Root tsconfig.json provides a shared base config for all packages to extend"
    - ".gitignore includes .turbo directory"
  artifacts:
    - path: "package.json"
      provides: "Root workspace manifest"
      contains: '"workspaces": ["packages/*"]'
    - path: "turbo.json"
      provides: "Turborepo task orchestration"
      contains: '"tasks"'
    - path: "tsconfig.json"
      provides: "Shared TypeScript base config"
      contains: '"moduleResolution": "bundler"'
  key_links:
    - from: "packages/gantt-lib/package.json"
      to: "package.json"
      via: "npm workspaces resolution"
      pattern: '"workspaces".*packages/\*'
---

<objective>
Replace the current monolithic Next.js root package.json with a private npm workspaces root, add Turborepo orchestration, and provide a shared TypeScript base config.

Purpose: Monorepo foundation that all subsequent package setup depends on.
Output: root package.json (private, workspaces), turbo.json, root tsconfig.json, updated .gitignore.
</objective>

<execution_context>
@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-npm-packaging/04-CONTEXT.md
@.planning/phases/04-npm-packaging/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace root package.json with private workspaces manifest</name>
  <files>package.json</files>
  <action>
    Replace the current root package.json (which is a full Next.js app manifest) with a private workspaces root manifest. The new package.json must:

    - `"name": "gantt-lib-monorepo"` (root name, never published)
    - `"private": true`
    - `"version": "0.0.1"`
    - `"workspaces": ["packages/*"]`
    - `"scripts"`: `"build": "turbo build"`, `"dev": "turbo dev"`, `"test": "turbo test"`, `"lint": "turbo lint"`
    - `"devDependencies"`: `"turbo": "^2.0.0"` (install it; do NOT include next, react, etc. — those belong in sub-packages)

    All existing dependencies (next, react, react-dom, date-fns, clsx, and all devDeps) are REMOVED from root — they will re-appear in the sub-packages in later plans.

    The `packages/` directory does not need to exist yet for this file change.
  </action>
  <verify>
    Read the new package.json and confirm it contains `"private": true`, `"workspaces": ["packages/*"]`, and `"turbo"` in devDependencies. The file must NOT contain `"next"`, `"react"`, `"react-dom"` as direct dependencies.
  </verify>
  <done>Root package.json is a valid private workspaces manifest with turbo devDep. No Next.js or React deps at root level.</done>
</task>

<task type="auto">
  <name>Task 2: Create turbo.json and root tsconfig.json, update .gitignore</name>
  <files>turbo.json, tsconfig.json, .gitignore</files>
  <action>
    1. Create `turbo.json` at repo root with the exact content from RESEARCH.md:
    ```json
    {
      "$schema": "https://turborepo.dev/schema.json",
      "tasks": {
        "build": {
          "dependsOn": ["^build"],
          "outputs": ["dist/**", ".next/**", "!.next/cache/**"]
        },
        "dev": {
          "cache": false,
          "persistent": true,
          "dependsOn": ["^build"]
        },
        "test": {
          "cache": true,
          "outputs": ["coverage/**"]
        },
        "lint": {
          "dependsOn": ["^lint"]
        }
      }
    }
    ```

    2. Replace the current root `tsconfig.json` (which is Next.js-specific with `"noEmit": true`, Next plugin, and `@/*` paths) with a clean shared base config:
    ```json
    {
      "compilerOptions": {
        "target": "ES2020",
        "lib": ["dom", "dom.iterable", "esnext"],
        "strict": true,
        "esModuleInterop": true,
        "skipLibCheck": true,
        "moduleResolution": "bundler",
        "resolveJsonModule": true,
        "isolatedModules": true,
        "jsx": "react-jsx"
      }
    }
    ```
    NOTE: Remove `"noEmit"`, `"plugins"`, `"paths"`, `"incremental"`, `"module"`, `"allowJs"` — those are package-specific. The shared base only sets the cross-package common options. Each sub-package tsconfig will extend this and add its own specifics.

    3. Update `.gitignore` — append `.turbo` on a new line in the "# Misc" section. Do NOT remove any existing entries.
  </action>
  <verify>
    1. `cat turbo.json` shows `"$schema"` and four tasks (build, dev, test, lint).
    2. `cat tsconfig.json` shows `"jsx": "react-jsx"` and does NOT contain `"noEmit"` or `"plugins"` or `"paths"`.
    3. `grep -c ".turbo" .gitignore` returns 1.
  </verify>
  <done>turbo.json exists with four tasks. Root tsconfig.json is a clean shared base. .gitignore contains .turbo entry.</done>
</task>

</tasks>

<verification>
From repo root:
1. `cat package.json` — confirms `"private": true` and `"workspaces": ["packages/*"]`
2. `cat turbo.json` — confirms four tasks with correct `dependsOn` declarations
3. `cat tsconfig.json` — confirms shared base options without Next.js-specific settings
4. `grep .turbo .gitignore` — confirms .turbo is ignored
</verification>

<success_criteria>
Root monorepo scaffold in place: private workspaces package.json, Turborepo config, shared TypeScript base, updated gitignore. No Next.js app still running from root (those move to packages/website in a later plan).
</success_criteria>

<output>
After completion, create `.planning/phases/04-npm-packaging/04-01-SUMMARY.md`
</output>
