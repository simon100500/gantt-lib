---
phase: 04-npm-packaging
plan: 04
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - packages/gantt-lib/src/index.ts
  - packages/gantt-lib/src/styles.css
  - packages/gantt-lib/src/components/GanttChart/GanttChart.tsx
  - packages/gantt-lib/src/components/GanttChart/GanttChart.css
  - packages/gantt-lib/src/components/GanttChart/index.tsx
  - packages/gantt-lib/src/components/TaskRow/TaskRow.tsx
  - packages/gantt-lib/src/components/TaskRow/TaskRow.css
  - packages/gantt-lib/src/components/TaskRow/index.tsx
  - packages/gantt-lib/src/components/TimeScaleHeader/TimeScaleHeader.tsx
  - packages/gantt-lib/src/components/TimeScaleHeader/TimeScaleHeader.css
  - packages/gantt-lib/src/components/TimeScaleHeader/index.tsx
  - packages/gantt-lib/src/components/GridBackground/GridBackground.tsx
  - packages/gantt-lib/src/components/GridBackground/GridBackground.css
  - packages/gantt-lib/src/components/GridBackground/index.tsx
  - packages/gantt-lib/src/components/TodayIndicator/TodayIndicator.tsx
  - packages/gantt-lib/src/components/TodayIndicator/TodayIndicator.css
  - packages/gantt-lib/src/components/TodayIndicator/index.tsx
  - packages/gantt-lib/src/components/DragGuideLines/DragGuideLines.tsx
  - packages/gantt-lib/src/components/DragGuideLines/DragGuideLines.css
  - packages/gantt-lib/src/components/index.ts
  - packages/gantt-lib/src/hooks/useTaskDrag.ts
  - packages/gantt-lib/src/hooks/index.ts
  - packages/gantt-lib/src/utils/dateUtils.ts
  - packages/gantt-lib/src/utils/geometry.ts
  - packages/gantt-lib/src/utils/index.ts
  - packages/gantt-lib/src/types/index.ts
  - packages/gantt-lib/src/__tests__/dateUtils.test.ts
  - packages/gantt-lib/src/__tests__/geometry.test.ts
  - packages/gantt-lib/src/__tests__/useTaskDrag.test.ts
autonomous: true
requirements: [DX-01, DX-02, DX-03, DX-04]

must_haves:
  truths:
    - "All library source files live in packages/gantt-lib/src/ (moved via git mv)"
    - "All .module.css files are renamed to .css (plain CSS, no CSS Modules scoping)"
    - "All component .tsx files import from './ComponentName.css' not '.module.css'"
    - "packages/gantt-lib/src/styles.css aggregates all component CSS via @import"
    - "packages/gantt-lib/src/index.ts exports all components, hooks, utils, and types with use client directive, and imports styles.css"
    - "Modal component is NOT present in packages/gantt-lib/src/ (website-only)"
    - "Original src/ directory remains intact until the final build-verify plan confirms success"
  artifacts:
    - path: "packages/gantt-lib/src/index.ts"
      provides: "Library entry point with all exports"
      contains: "'use client'"
    - path: "packages/gantt-lib/src/styles.css"
      provides: "CSS aggregator for tsup emission"
      contains: "@import"
    - path: "packages/gantt-lib/src/components/GanttChart/GanttChart.css"
      provides: "Plain CSS (no modules) for GanttChart"
  key_links:
    - from: "packages/gantt-lib/src/index.ts"
      to: "packages/gantt-lib/src/styles.css"
      via: "CSS import triggering tsup emission"
      pattern: "import.*styles\\.css"
    - from: "packages/gantt-lib/src/components/GanttChart/GanttChart.tsx"
      to: "packages/gantt-lib/src/components/GanttChart/GanttChart.css"
      via: "plain CSS import (not module)"
      pattern: "import.*GanttChart\\.css"
---

<objective>
Move all library source files into packages/gantt-lib/src/ using git mv, rename every .module.css to .css, update all CSS import statements in components, and create the library entry point (src/index.ts) and CSS aggregator (src/styles.css).

Purpose: Populate the library package with actual source so tsup can build it.
Output: packages/gantt-lib/src/ with all library files, plain CSS (no modules), and a single-entry index.ts exposing all public API.
</objective>

<execution_context>
@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-npm-packaging/04-CONTEXT.md
@.planning/phases/04-npm-packaging/04-RESEARCH.md
@.planning/phases/04-npm-packaging/04-02-SUMMARY.md
@src/components/GanttChart/GanttChart.tsx
@src/components/index.ts
@src/types/index.ts
@src/hooks/index.ts
@src/utils/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: git mv source files to packages/gantt-lib/src/</name>
  <files>
    packages/gantt-lib/src/components/GanttChart/GanttChart.tsx,
    packages/gantt-lib/src/components/GanttChart/index.tsx,
    packages/gantt-lib/src/components/TaskRow/TaskRow.tsx,
    packages/gantt-lib/src/components/TaskRow/index.tsx,
    packages/gantt-lib/src/components/TimeScaleHeader/TimeScaleHeader.tsx,
    packages/gantt-lib/src/components/TimeScaleHeader/index.tsx,
    packages/gantt-lib/src/components/GridBackground/GridBackground.tsx,
    packages/gantt-lib/src/components/GridBackground/index.tsx,
    packages/gantt-lib/src/components/TodayIndicator/TodayIndicator.tsx,
    packages/gantt-lib/src/components/TodayIndicator/index.tsx,
    packages/gantt-lib/src/components/DragGuideLines/DragGuideLines.tsx,
    packages/gantt-lib/src/hooks/useTaskDrag.ts,
    packages/gantt-lib/src/hooks/index.ts,
    packages/gantt-lib/src/utils/dateUtils.ts,
    packages/gantt-lib/src/utils/geometry.ts,
    packages/gantt-lib/src/utils/index.ts,
    packages/gantt-lib/src/types/index.ts,
    packages/gantt-lib/src/__tests__/dateUtils.test.ts,
    packages/gantt-lib/src/__tests__/geometry.test.ts,
    packages/gantt-lib/src/__tests__/useTaskDrag.test.ts
  </files>
  <action>
    Move library source files from the old `src/` location to `packages/gantt-lib/src/` using git mv to preserve history. Execute these git mv commands (from the repo root D:/Projects/gantt-lib):

    Create target directories first (git mv requires targets to exist):
    ```bash
    mkdir -p packages/gantt-lib/src/components/GanttChart
    mkdir -p packages/gantt-lib/src/components/TaskRow
    mkdir -p packages/gantt-lib/src/components/TimeScaleHeader
    mkdir -p packages/gantt-lib/src/components/GridBackground
    mkdir -p packages/gantt-lib/src/components/TodayIndicator
    mkdir -p packages/gantt-lib/src/components/DragGuideLines
    mkdir -p packages/gantt-lib/src/hooks
    mkdir -p packages/gantt-lib/src/utils
    mkdir -p packages/gantt-lib/src/types
    mkdir -p packages/gantt-lib/src/__tests__
    ```

    Move component .tsx files (NOT the .module.css — those get renamed separately):
    ```bash
    git mv src/components/GanttChart/GanttChart.tsx packages/gantt-lib/src/components/GanttChart/GanttChart.tsx
    git mv src/components/GanttChart/index.tsx packages/gantt-lib/src/components/GanttChart/index.tsx
    git mv src/components/TaskRow/TaskRow.tsx packages/gantt-lib/src/components/TaskRow/TaskRow.tsx
    git mv src/components/TaskRow/index.tsx packages/gantt-lib/src/components/TaskRow/index.tsx
    git mv src/components/TimeScaleHeader/TimeScaleHeader.tsx packages/gantt-lib/src/components/TimeScaleHeader/TimeScaleHeader.tsx
    git mv src/components/TimeScaleHeader/index.tsx packages/gantt-lib/src/components/TimeScaleHeader/index.tsx
    git mv src/components/GridBackground/GridBackground.tsx packages/gantt-lib/src/components/GridBackground/GridBackground.tsx
    git mv src/components/GridBackground/index.tsx packages/gantt-lib/src/components/GridBackground/index.tsx
    git mv src/components/TodayIndicator/TodayIndicator.tsx packages/gantt-lib/src/components/TodayIndicator/TodayIndicator.tsx
    git mv src/components/TodayIndicator/index.tsx packages/gantt-lib/src/components/TodayIndicator/index.tsx
    git mv src/components/DragGuideLines/DragGuideLines.tsx packages/gantt-lib/src/components/DragGuideLines/DragGuideLines.tsx
    ```

    Move hooks, utils, types, tests:
    ```bash
    git mv src/hooks/useTaskDrag.ts packages/gantt-lib/src/hooks/useTaskDrag.ts
    git mv src/hooks/index.ts packages/gantt-lib/src/hooks/index.ts
    git mv src/utils/dateUtils.ts packages/gantt-lib/src/utils/dateUtils.ts
    git mv src/utils/geometry.ts packages/gantt-lib/src/utils/geometry.ts
    git mv src/utils/index.ts packages/gantt-lib/src/utils/index.ts
    git mv src/types/index.ts packages/gantt-lib/src/types/index.ts
    git mv src/__tests__/dateUtils.test.ts packages/gantt-lib/src/__tests__/dateUtils.test.ts
    git mv src/__tests__/geometry.test.ts packages/gantt-lib/src/__tests__/geometry.test.ts
    git mv src/__tests__/useTaskDrag.test.ts packages/gantt-lib/src/__tests__/useTaskDrag.test.ts
    ```

    Move CSS files with rename (drop .module suffix — rename from .module.css to .css):
    ```bash
    git mv src/components/GanttChart/GanttChart.module.css packages/gantt-lib/src/components/GanttChart/GanttChart.css
    git mv src/components/TaskRow/TaskRow.module.css packages/gantt-lib/src/components/TaskRow/TaskRow.css
    git mv src/components/TimeScaleHeader/TimeScaleHeader.module.css packages/gantt-lib/src/components/TimeScaleHeader/TimeScaleHeader.css
    git mv src/components/GridBackground/GridBackground.module.css packages/gantt-lib/src/components/GridBackground/GridBackground.css
    git mv src/components/TodayIndicator/TodayIndicator.module.css packages/gantt-lib/src/components/TodayIndicator/TodayIndicator.css
    git mv src/components/DragGuideLines/DragGuideLines.module.css packages/gantt-lib/src/components/DragGuideLines/DragGuideLines.css
    ```

    Do NOT move:
    - `src/components/Modal/` (website-only, already copied to packages/website in plan 04-03)
    - `src/components/index.ts` (old barrel with Modal — will be replaced in Task 2)
    - `src/app/` (website-only)

    After all moves, verify `git status` shows the moves as renames (not delete+add).
  </action>
  <verify>
    ```bash
    ls packages/gantt-lib/src/components/GanttChart/
    # Should show: GanttChart.tsx  GanttChart.css  index.tsx
    ls packages/gantt-lib/src/components/TaskRow/
    # Should show: TaskRow.tsx  TaskRow.css  index.tsx
    git status --short | grep "^R" | wc -l
    # Should show ~20+ renames
    ls packages/gantt-lib/src/components/DragGuideLines/
    # Should show: DragGuideLines.tsx  DragGuideLines.css
    ```
  </verify>
  <done>All library .tsx/.ts files and CSS files (renamed to .css) exist in packages/gantt-lib/src/. git status shows them as renames. No .module.css files remain in packages/gantt-lib/src/.</done>
</task>

<task type="auto">
  <name>Task 2: Update CSS imports in components, create styles.css aggregator and library index.ts</name>
  <files>
    packages/gantt-lib/src/components/GanttChart/GanttChart.tsx,
    packages/gantt-lib/src/components/TaskRow/TaskRow.tsx,
    packages/gantt-lib/src/components/TimeScaleHeader/TimeScaleHeader.tsx,
    packages/gantt-lib/src/components/GridBackground/GridBackground.tsx,
    packages/gantt-lib/src/components/TodayIndicator/TodayIndicator.tsx,
    packages/gantt-lib/src/components/DragGuideLines/DragGuideLines.tsx,
    packages/gantt-lib/src/components/index.ts,
    packages/gantt-lib/src/styles.css,
    packages/gantt-lib/src/index.ts
  </files>
  <action>
    After the git mv, CSS import statements in component files still say `styles from './ComponentName.module.css'` (CSS Modules syntax). These must be changed to plain CSS imports.

    For each component, replace the CSS Modules import with a plain CSS import AND replace all `styles.className` references with plain string class names:

    **GanttChart.tsx** — change:
    - `import styles from './GanttChart.module.css';` → `import './GanttChart.css';`
    - `className={styles.container}` → `className="gantt-container"`
    - `className={styles.scrollContainer}` → `className="gantt-scrollContainer"`
    - `className={styles.stickyHeader}` → `className="gantt-stickyHeader"`
    - `className={styles.taskArea}` → `className="gantt-taskArea"`

    And in GanttChart.css, replace the local class selectors with the new names:
    - `.container` → `.gantt-container`
    - `.scrollContainer` → `.gantt-scrollContainer`
    - `.stickyHeader` → `.gantt-stickyHeader`
    - `.taskArea` → `.gantt-taskArea`

    **TaskRow.tsx** — change:
    - `import styles from './TaskRow.module.css';` → `import './TaskRow.css';`
    - Replace all `styles.X` references with `"gantt-row-X"` string literals (or `"gantt-taskRow-X"` prefix — pick a consistent prefix `gantt-tr-`)
    - In TaskRow.css, rename all `.X` selectors to match.

    Use prefix `gantt-tr-` for TaskRow classes. Example: `styles.row` → `"gantt-tr-row"`, `styles.taskBar` → `"gantt-tr-taskBar"`, `styles.dragging` → `"gantt-tr-dragging"`, etc.

    For TaskRow the dragging compound class `${styles.taskBar} ${isDragging ? styles.dragging : ''}` becomes `\`gantt-tr-taskBar\${isDragging ? ' gantt-tr-dragging' : ''}\``.

    **TimeScaleHeader.tsx** — change:
    - `import styles from './TimeScaleHeader.module.css';` → `import './TimeScaleHeader.css';`
    - Use prefix `gantt-tsh-` for all class names.
    - In TimeScaleHeader.css rename `.header` → `.gantt-tsh-header`, etc.
    - Compound class with conditional (e.g., `${styles.dayCell} ${styles.weekendDay}`) becomes template literals with gantt-tsh- prefix.

    **GridBackground.tsx** — change:
    - `import styles from './GridBackground.module.css';` → `import './GridBackground.css';`
    - Use prefix `gantt-gb-` for all class names.

    **TodayIndicator.tsx** — change:
    - `import styles from './TodayIndicator.module.css';` → `import './TodayIndicator.css';`
    - Use prefix `gantt-ti-` for all class names.

    **DragGuideLines.tsx** — change:
    - `import styles from './DragGuideLines.module.css';` → `import './DragGuideLines.css';`
    - Use prefix `gantt-dgl-` for all class names.

    **Important:** Read each component file fully before editing to understand all `styles.X` usages. clsx() calls using styles.X must also be updated. After editing each .tsx, also edit the corresponding .css to rename selectors.

    **Update packages/gantt-lib/src/components/index.ts** — replace the old barrel (which exported Modal) with:
    ```typescript
    export { GanttChart, type Task, type GanttChartProps } from './GanttChart';
    export { default as TaskRow } from './TaskRow';
    export { default as TimeScaleHeader } from './TimeScaleHeader';
    export { default as GridBackground } from './GridBackground';
    export { default as TodayIndicator } from './TodayIndicator';
    export { DragGuideLines } from './DragGuideLines/DragGuideLines';
    ```
    Note: Modal is NOT exported.

    **Create packages/gantt-lib/src/styles.css** — CSS aggregator that @imports all component CSS files:
    ```css
    @import './components/GanttChart/GanttChart.css';
    @import './components/TaskRow/TaskRow.css';
    @import './components/TimeScaleHeader/TimeScaleHeader.css';
    @import './components/GridBackground/GridBackground.css';
    @import './components/TodayIndicator/TodayIndicator.css';
    @import './components/DragGuideLines/DragGuideLines.css';
    ```

    **Create packages/gantt-lib/src/index.ts** — single entry point with `'use client'` directive, all exports, and CSS import:
    ```typescript
    'use client';

    // CSS import triggers tsup to emit dist/index.css (renamed to dist/styles.css by onSuccess)
    import './styles.css';

    // Components
    export { GanttChart, type Task, type GanttChartProps } from './components/GanttChart';
    export { default as TaskRow } from './components/TaskRow';
    export { default as TimeScaleHeader } from './components/TimeScaleHeader';
    export { default as GridBackground } from './components/GridBackground';
    export { default as TodayIndicator } from './components/TodayIndicator';
    export { DragGuideLines } from './components/DragGuideLines/DragGuideLines';

    // Hooks
    export { useTaskDrag } from './hooks';

    // Utils
    export * from './utils';

    // Types
    export type {
      GanttDateRange,
      TaskBarGeometry,
      GridConfig,
      MonthSpan,
      GridLine,
      WeekendBlock,
    } from './types';
    ```

    Update the test files' import paths if they reference `../../utils` or similar — check each test file and update relative imports to point to the correct location within packages/gantt-lib/src/.
  </action>
  <verify>
    1. `grep -r "module.css" packages/gantt-lib/src/` — must return 0 results (no .module.css imports remain)
    2. `grep "'use client'" packages/gantt-lib/src/index.ts` — returns match
    3. `grep "import './styles.css'" packages/gantt-lib/src/index.ts` — returns match
    4. `cat packages/gantt-lib/src/styles.css` — shows @import for all 6 component CSS files
    5. `grep "Modal" packages/gantt-lib/src/index.ts` — returns 0 results (Modal not exported)
    6. `grep "Modal" packages/gantt-lib/src/components/index.ts` — returns 0 results
  </verify>
  <done>All .module.css imports replaced with plain CSS imports. Class names prefixed to avoid collisions. styles.css aggregator created. Library index.ts exports all public API with 'use client' and CSS import. Modal excluded from all library exports.</done>
</task>

</tasks>

<verification>
From repo root:
1. `find packages/gantt-lib/src -name "*.module.css"` — returns empty (no CSS Modules files)
2. `find packages/gantt-lib/src -name "*.css" | sort` — shows 6 component CSS files + styles.css
3. `cat packages/gantt-lib/src/index.ts` — shows 'use client' on line 1, CSS import, and all component/hook/util/type exports
4. `grep -r "from.*Modal" packages/gantt-lib/src/` — returns empty (no Modal refs in library)
5. `git status --short | grep "^R" | head -5` — shows git renames (history preserved)
</verification>

<success_criteria>
packages/gantt-lib/src/ contains the complete library source. No CSS Modules remain. CSS aggregator and library index.ts exist. All exports are present. Modal is absent from library. Git history preserved via git mv.
</success_criteria>

<output>
After completion, create `.planning/phases/04-npm-packaging/04-04-SUMMARY.md`
</output>
