---
phase: 05-progress-bars
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/gantt-lib/src/types/index.ts
  - packages/gantt-lib/src/components/TaskRow/TaskRow.tsx
  - packages/gantt-lib/src/components/TaskRow/TaskRow.css
  - packages/gantt-lib/src/styles.css
autonomous: false
requirements: []

must_haves:
  truths:
    - "Task bars with progress > 0 display a horizontal fill overlay from left to right"
    - "Progress 0% is hidden (no overlay visible)"
    - "Progress 100% shows yellow overlay for completed tasks"
    - "Progress 100% with accepted=true shows green overlay"
    - "Progress between 1-99% shows darker semi-transparent shade of task color"
    - "Task text remains readable above progress overlay"
    - "Progress updates smoothly without causing re-render storms"
  artifacts:
    - path: "packages/gantt-lib/src/types/index.ts"
      provides: "Task interface with progress and accepted properties"
      contains: "progress?: number"
      contains: "accepted?: boolean"
    - path: "packages/gantt-lib/src/components/TaskRow/TaskRow.tsx"
      provides: "Progress bar rendering logic"
      min_lines: 20
      contains: "progressWidth"
      contains: "progressColor"
      contains: "gantt-tr-progressBar"
    - path: "packages/gantt-lib/src/components/TaskRow/TaskRow.css"
      provides: "Progress bar overlay styles"
      contains: ".gantt-tr-progressBar"
    - path: "packages/gantt-lib/src/styles.css"
      provides: "CSS variables for progress colors"
      contains: "--gantt-progress-color"
      contains: "--gantt-progress-completed"
      contains: "--gantt-progress-accepted"
  key_links:
    - from: "packages/gantt-lib/src/components/TaskRow/TaskRow.tsx"
      to: "packages/gantt-lib/src/types/index.ts"
      via: "Task interface import"
      pattern: "progress.*accepted"
    - from: "TaskRow component render"
      to: "progress bar overlay"
      via: "conditional rendering with progress > 0 check"
      pattern: "progressWidth.*>.*0"
    - from: "progress bar color"
      to: "CSS color-mix() or variables"
      via: "backgroundColor style calculation"
      pattern: "color-mix.*progress.*accepted"
---

<objective>
Add visual progress indicators to Gantt chart task bars. Progress displays as a horizontal fill overlay from left to right, with colors indicating completion status (darker shade for partial progress, yellow for 100% completed, green for 100% accepted). Progress is read-only and controlled programmatically via props.

Purpose: Provide visual feedback on task completion status without adding UI complexity or interaction overhead.

Output: Enhanced Task interface with progress properties, progress bar overlay rendering in TaskRow, CSS variables for progress color theming.
</objective>

<execution_context>
@C:/Users/simon/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/simon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/05-progress-bars/05-CONTEXT.md
@.planning/phases/05-progress-bars/05-RESEARCH.md

# Existing codebase patterns
@packages/gantt-lib/src/components/TaskRow/TaskRow.tsx
@packages/gantt-lib/src/types/index.ts
@packages/gantt-lib/src/components/TaskRow/TaskRow.css
@packages/gantt-lib/src/styles.css
</context>

<tasks>

<task type="auto">
  <name>Extend Task interface with progress properties</name>
  <files>packages/gantt-lib/src/types/index.ts</files>
  <action>
    Add two optional properties to the Task interface:
    1. `progress?: number` - Optional progress value from 0-100 (decimals allowed, undefined = no progress)
    2. `accepted?: boolean` - Optional flag indicating if task is accepted (only meaningful when progress is 100%)

    Add JSDoc comments explaining:
    - progress values are clamped to 0-100 range
    - decimal values are rounded to nearest integer
    - progress is visual-only, no user interaction

    Reference existing Task interface structure for consistent style.
  </action>
  <verify>
    grep -n "progress.*number" packages/gantt-lib/src/types/index.ts returns the property definition
    grep -n "accepted.*boolean" packages/gantt-lib/src/types/index.ts returns the property definition
  </verify>
  <done>
    Task interface includes progress?: number and accepted?: boolean with JSDoc documentation
  </done>
</task>

<task type="auto">
  <name>Add progress bar rendering to TaskRow component</name>
  <files>packages/gantt-lib/src/components/TaskRow/TaskRow.tsx</files>
  <action>
    Inside TaskRow component, add progress rendering logic:

    1. Calculate clamped and rounded progress width using useMemo:
       - Return 0 if progress is undefined or <= 0
       - Clamp to 0-100 range: Math.min(100, Math.max(0, Math.round(task.progress)))
       - Memoize on [task.progress]

    2. Determine progress color using useMemo:
       - If progressWidth === 100 and task.accepted is true: green color (--gantt-progress-accepted, #22c55e)
       - If progressWidth === 100 and task.accepted is false/undefined: yellow color (--gantt-progress-completed, #fbbf24)
       - Otherwise: darker semi-transparent shade using color-mix() or fallback to --gantt-progress-color (rgba(0, 0, 0, 0.2))
       - Memoize on [progressWidth, task.accepted, task.color]

    3. Render progress bar overlay:
       - Add div with className "gantt-tr-progressBar" BEFORE existing task bar content
       - Conditionally render: {progressWidth > 0 && <div className="gantt-tr-progressBar" ... />}
       - Set inline styles: width: `${progressWidth}%`, backgroundColor: progressColor
       - Position must be absolute to overlay task bar background without affecting layout

    4. Update React.memo comparison function (arePropsEqual):
       - Add prevProps.task.progress === nextProps.task.progress comparison
       - Add prevProps.task.accepted === nextProps.task.accepted comparison
       - This prevents re-render storms when progress changes (QL-01 requirement)

    Reference existing TaskRow patterns for useMemo usage and memoization.
  </action>
  <verify>
    grep -n "progressWidth" packages/gantt-lib/src/components/TaskRow/TaskRow.tsx shows calculation
    grep -n "progressColor" packages/gantt-lib/src/components/TaskRow/TaskRow.tsx shows color logic
    grep -n "gantt-tr-progressBar" packages/gantt-lib/src/components/TaskRow/TaskRow.tsx shows rendering
    grep -n "task.progress" packages/gantt-lib/src/components/TaskRow/TaskRow.tsx shows memo comparison
  </verify>
  <done>
    Progress bar overlay renders for tasks with progress > 0, colors match completion status, React.memo prevents re-render storms
  </done>
</task>

<task type="auto">
  <name>Add progress bar CSS styles and theme variables</name>
  <files>packages/gantt-lib/src/components/TaskRow/TaskRow.css packages/gantt-lib/src/styles.css</files>
  <action>
    1. In packages/gantt-lib/src/styles.css, add CSS variables for progress theming:
       - --gantt-progress-color: rgba(0, 0, 0, 0.2) - default darker overlay for partial progress
       - --gantt-progress-completed: #fbbf24 - yellow for 100% completed
       - --gantt-progress-accepted: #22c55e - green for 100% + accepted

    2. In packages/gantt-lib/src/components/TaskRow/TaskRow.css, add progress bar overlay styles:
       - .gantt-tr-taskBar: add overflow: hidden to contain progress bar within rounded corners
       - .gantt-tr-progressBar:
         * position: absolute, top: 0, left: 0, bottom: 0 (full height of task bar)
         * z-index: 1 (below text but above background)
         * pointer-events: none (allow clicks to pass through to task bar)
         * border-radius: var(--gantt-task-bar-border-radius) 0 0 var(--gantt-task-bar-border-radius) (left radius only for fill effect)
         * transition: width 0.3s ease (smooth width changes)

    3. Ensure text stays above progress bar:
       - .gantt-tr-taskName, .gantt-tr-taskDuration, .gantt-tr-resizeHandle:
         * position: relative
         * z-index: 2

    4. Disable transition during drag:
       - .gantt-tr-taskBar.gantt-tr-dragging .gantt-tr-progressBar:
         * transition: none !important

    Reference existing TaskRow.css patterns for consistency with task bar styling.
  </action>
  <verify>
    grep -n "gantt-tr-progressBar" packages/gantt-lib/src/components/TaskRow/TaskRow.css shows progress bar styles
    grep -n "--gantt-progress" packages/gantt-lib/src/styles.css shows progress color variables
    grep -n "overflow.*hidden" packages/gantt-lib/src/components/TaskRow/TaskRow.css shows task bar containment
  </verify>
  <done>
    Progress bar overlay styles position it below text, CSS variables allow theme customization, transitions disabled during drag
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete progress bar implementation with type extensions, rendering logic, CSS styles, and theme variables</what-built>
  <how-to-verify>
    1. Start the website dev server: cd packages/website && npm run dev
    2. Open http://localhost:3000 in browser
    3. Add progress values to sample tasks in the demo data:
       - Task 1: progress: 0 (should show NO progress bar)
       - Task 2: progress: 45.7 (should show ~46% darker overlay)
       - Task 3: progress: 100 (should show full yellow overlay)
       - Task 4: progress: 100, accepted: true (should show full green overlay)
       - Task 5: progress: 150 (should clamp to 100% and show yellow)
       - Task 6: progress: -10 (should clamp to 0% and show no overlay)
    4. Verify each task displays correct progress visualization
    5. Test drag operations: drag a task with progress and verify no lag/ghosting
    6. Test with custom task colors: progress overlay should be darker shade of task color
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with progress bar rendering</resume-signal>
</task>

</tasks>

<verification>
Overall phase checks:
1. Progress bars render for tasks with progress > 0
2. Progress 0% is hidden (no visible overlay)
3. Progress 100% shows yellow overlay for completed tasks
4. Progress 100% with accepted=true shows green overlay
5. Partial progress (1-99%) shows darker semi-transparent overlay
6. Task text remains readable above progress overlay
7. React.memo optimization prevents re-render storms
8. Transitions are smooth but disabled during drag
9. CSS variables allow customization
10. No TypeScript errors after type extensions
</verification>

<success_criteria>
Measurable completion:
1. TypeScript compiles without errors in packages/gantt-lib
2. Progress bar overlay visible on tasks with progress > 0
3. Correct colors for each completion state (partial, completed, accepted)
4. Task text readable above overlay (z-index correct)
5. No performance degradation during drag operations
6. CSS variables documented in styles.css
</success_criteria>

<output>
After completion, create `.planning/phases/05-progress-bars/05-01-SUMMARY.md`
</output>
