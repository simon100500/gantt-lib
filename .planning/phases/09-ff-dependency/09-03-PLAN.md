---
phase: 09-ff-dependency
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - packages/website/src/app/page.tsx
autonomous: false
requirements: []

must_haves:
  truths:
    - "Demo page shows A→(FF)→B linked task pair in the Construction Project"
    - "Dragging A left/right moves B with it in real-time (cascade preview visible)"
    - "Dragging A's right edge moves B to preserve lag (endA changes)"
    - "Dragging A's left edge does NOT move B (endA unchanged, FF unaffected)"
    - "Dragging B left/right moves freely (no constraint clamp, lag recalculated)"
    - "Resizing B's right edge changes duration, lag recalculated"
    - "Resizing B's left edge changes duration, lag preserved (endB unchanged)"
    - "FF dependency line renders visually (finish-to-finish connection points)"
    - "FF lag can be negative (B can finish before A, lag recalculated correctly)"
  artifacts:
    - path: "packages/website/src/app/page.tsx"
      provides: "FF demo task pair in Construction Project with visible FF constraints"
  key_links:
    - from: "packages/website/src/app/page.tsx"
      to: "gantt-lib cascade hooks"
      via: "handleCascade → cascadeOverrides → TaskRow overridePosition"
      pattern: "onCascade"
---

<objective>
Add a visible FF dependency demo to the Construction Project demo page so the FF constraint behavior can be manually verified end-to-end.

Purpose: The FF implementation from Plans 01+02 needs a working demo to confirm the behavior visually before shipping. The website already has FS and SS dependency examples; adding an FF pair completes all four link type demonstrations (FS, SS, FF — SF is deferred).
Output: page.tsx with 1-2 new FF-linked tasks added to the Construction Project task list; human verification of all FF drag scenarios.
</objective>

<execution_context>
@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/09-ff-dependency/09-CONTEXT.md
@.planning/phases/09-ff-dependency/09-02-SUMMARY.md
@.planning/phases/08-ss-dependency/08-03-SUMMARY.md
@packages/website/src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FF-linked task pair to Construction Project demo</name>
  <files>packages/website/src/app/page.tsx</files>
  <action>
    Read packages/website/src/app/page.tsx to understand the current task data structure
    (Construction Project tasks array with id, name, startDate, endDate, color, dependencies).

    Add 2 tasks to the Construction Project task list that demonstrate FF constraints:
    - Task name: "Framing & Structure" (predecessor A) — start 2025-01-20, end 2025-02-05, color '#f59e0b'
    - Task name: "Interior Finishing" (successor B) — start 2025-01-25, end 2025-02-08, color '#d97706',
      dependencies: [{ taskId: '<id-of-Framing>', type: 'FF', lag: 3 }]

    The lag of 3 means Interior Finishing finishes 3 days after Framing & Structure finishes.
    Verify: Feb 8 is 3 days after Feb 5.

    Choose IDs that fit the existing scheme. Based on Phase 8, IDs are likely like:
    'framing-structure' and 'interior-finishing'.

    Place the tasks at the end of the task list or in a logical position within the project.
    Ensure the tasks are within the existing date range so they render on the calendar.
    The current demo uses 2025-01-06 to 2025-02-20 range, adjust if needed.

    After editing, run: npm run build --filter packages/website to check for errors.
    If build succeeds, commit: feat(09-03): add FF dependency demo tasks to Construction Project
  </action>
  <verify>
    cd D:/Projects/gantt-lib && npm run build --filter packages/website 2>&1 | tail -20
    No TypeScript or build errors.
    Two new tasks appear in the page.tsx task array with FF dependency.
  </verify>
  <done>
    page.tsx has FF-linked task pair. Build succeeds. Interior Finishing has
    dependencies: [{ taskId: '...', type: 'FF', lag: 3 }].
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    FF dependency constraint enforcement wired end-to-end:
    - recalculateIncomingLags extended with newEndDate parameter and FF case (Plan 01)
    - ActiveDragState extended with cascadeChainEnd for FS+FF (Plan 02)
    - cascadeChain updated to include FF for move mode (Plan 02)
    - Cascade emission uses cascadeChainEnd for resize-right mode (Plan 02)
    - handleComplete FF-aware chain selection: resize-right and move include FF (Plan 02)
    - FF demo tasks added to Construction Project (Plan 03 Task 1)
  </what-built>
  <how-to-verify>
    Run: cd D:/Projects/gantt-lib && npm run dev
    Open: http://localhost:3000

    Locate "Framing & Structure" (A) and "Interior Finishing" (B) tasks in the Construction Project.
    The FF dependency line should connect them end-to-end (right edge to right edge).

    Test each scenario (hard mode, disableConstraints=false):

    1. DRAG A RIGHT: Grab Framing bar middle → drag right.
       Expected: Interior Finishing moves right with same delta in real-time.
       Confirm: After drop, both tasks' end dates shifted equally.

    2. DRAG A LEFT: Grab Framing bar middle → drag left.
       Expected: Interior Finishing moves left with same delta.
       Confirm: FF lag preserved (endB - endA constant).

    3. RESIZE A RIGHT EDGE: Grab right edge of Framing → drag right.
       Expected: Interior Finishing moves right to preserve lag (endA changed).
       Confirm: B's end date shifts with A's end date.

    4. RESIZE A LEFT EDGE: Grab left edge of Framing → drag left.
       Expected: Interior Finishing does NOT move (endA unchanged, FF unaffected).
       Confirm: Only A's duration changes. B stays put.

    5. DRAG B RIGHT: Grab Interior Finishing bar middle → drag right.
       Expected: B moves right freely. No blocking. Lag increases.
       Confirm: After drop, lag = endB - endA is larger.

    6. DRAG B LEFT: Grab Interior Finishing bar middle → drag left.
       Expected: B moves left freely. No blocking. Lag decreases (can go negative).
       Confirm: B can move past A's end date (negative lag allowed).

    7. RESIZE B RIGHT EDGE: Grab right edge of Interior Finishing → drag right.
       Expected: B's duration increases. Lag recalculated.
       Confirm: After drop, lag = newEndB - endA.

    8. RESIZE B LEFT EDGE: Grab left edge of Interior Finishing → drag left.
       Expected: B's duration changes (startB shifts). Lag preserved (endB unchanged).
       Confirm: After drop, lag = endB - endA unchanged.

    9. VERIFY FF LINE: The dependency line connects A's right edge to B's right edge.
       Expected: Type-aware connection points from Phase 8 work for FF.

    10. TEST NEGATIVE LAG: Drag B left until it ends before A ends.
        Expected: B finishes before A. Lag becomes negative.
        Confirm: After drop, lag is correctly calculated as negative value.
  </how-to-verify>
  <resume-signal>Type "approved" if all 10 scenarios work correctly, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
Visual verification via human tester per checkpoint above.
All 10 FF interaction scenarios from CONTEXT.md behavior matrix must work correctly.
</verification>

<success_criteria>
- FF demo tasks visible in Construction Project on demo page
- All 10 FF drag scenarios produce correct behavior
- No JavaScript errors in browser console during any FF interaction
- FF dependency line renders correctly (end-to-end connection)
- Negative lag works correctly (B can finish before A)
- FS and SS dependency behaviors on existing tasks are unchanged (regression check)
</success_criteria>

<output>
After completion, create `.planning/phases/09-ff-dependency/09-03-SUMMARY.md`
</output>
