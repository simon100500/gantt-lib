---
phase: 03-calendar
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/components/GridBackground/GridBackground.tsx
  - src/components/GridBackground/GridBackground.module.css
  - src/components/GridBackground/index.tsx
autonomous: true
requirements:
  - API-03
  - DX-01
  - DX-02
  - DX-03
  - DX-04

must_haves:
  truths:
    - "User can see vertical grid lines spanning full height of calendar"
    - "User can see pink background highlighting weekend days"
    - "User can see thick dark lines separating months"
    - "User can see thin lighter lines separating weeks"
  artifacts:
    - path: "src/components/GridBackground/GridBackground.tsx"
      provides: "Vertical grid lines and weekend background rendering"
      min_lines: 80
    - path: "src/components/GridBackground/GridBackground.module.css"
      provides: "Styling for grid lines and weekend backgrounds"
      min_lines: 30
    - path: "src/components/GridBackground/index.tsx"
      provides: "Component barrel export"
  key_links:
    - from: "src/components/GridBackground/GridBackground.tsx"
      to: "src/utils/geometry.ts"
      via: "calculateGridLines, calculateWeekendBlocks"
      pattern: "calculateGridLines|calculateWeekendBlocks"
    - from: "src/components/GridBackground/GridBackground.tsx"
      to: "src/utils/dateUtils.ts"
      via: "isWeekend"
      pattern: "isWeekend"
    - from: "src/components/GridBackground/GridBackground.module.css"
      to: "src/app/globals.css"
      via: "CSS variables (--gantt-weekend-background, etc.)"
      pattern: "var\\(--gantt-"
---

<objective>
Create GridBackground component that renders vertical grid lines and weekend background highlighting for the calendar grid.

Purpose: This component provides the visual grid structure that runs behind task rows. It separates grid rendering from task rendering for better performance and cleaner code.

Output: Working GridBackground component with vertical lines (month/week/day separators) and pink weekend backgrounds.
</objective>

<execution_context>
@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-calendar/03-CONTEXT.md
@.planning/phases/03-calendar/03-RESEARCH.md
@.planning/phases/03-calendar/03-01-SUMMARY.md

@src/components/TaskRow/TaskRow.tsx
@src/components/GanttChart/GanttChart.tsx
@src/utils/geometry.ts
@src/utils/dateUtils.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Create GridBackground component</name>
  <files>src/components/GridBackground/GridBackground.tsx</files>
  <action>
Create src/components/GridBackground/GridBackground.tsx:

1. **Interface:**
```typescript
import React, { useMemo } from 'react';
import { calculateGridLines, calculateWeekendBlocks } from '../../utils/geometry';
import type { GridLine } from '../../types';
import styles from './GridBackground.module.css';

export interface GridBackgroundProps {
  /** Array of dates to display (from getMultiMonthDays) */
  dateRange: Date[];
  /** Width of each day column in pixels */
  dayWidth: number;
  /** Total height of the grid area in pixels */
  totalHeight: number;
}
```

2. **Component implementation:**
   - Use useMemo to calculate grid lines from dateRange
   - Use useMemo to calculate weekend blocks
   - Render weekend backgrounds first (layered behind lines)
   - Render vertical grid lines with conditional classes:
     * Month separator: .monthSeparator (thick, dark)
     * Week separator (not month): .weekSeparator (thin, lighter)
     * Regular day: .dayLine (thinnest, palest)

3. **CSS styling:**
   - Position: absolute, top: 0, left: 0
   - Width: dateRange.length * dayWidth
   - Height: totalHeight (from props)
   - Pointer events: none (clicks pass through to tasks)

4. **Class logic:**
   - Use clsx or conditional classes for line types
   - Month separators take precedence over week separators
   - Week separators take precedence over day lines

Implementation must follow existing patterns:
- Use React.memo with custom comparison (exclude totalHeight from comparison)
- useMemo for expensive calculations
- Absolute positioning for grid lines
- CSS Modules for styling

DO NOT:
- Render grid lines in each TaskRow (causes performance issues)
- Use inline styles for all dimensions (use CSS variables)
- Create grid lines manually (use calculateGridLines utility)
  </action>
  <verify>
npm test passes
TypeScript compilation: npx tsc --noEmit
Component renders without errors in Storybook/dev
  </verify>
  <done>
GridBackground component exists and is exported
Vertical lines render at correct x positions
Month separators are thicker and darker
Week separators are thinner and lighter
Weekend backgrounds have pink color
Grid lines span full height
Component uses React.memo optimization
  </done>
</task>

<task type="auto">
  <name>Create GridBackground styles and barrel export</name>
  <files>src/components/GridBackground/GridBackground.module.css src/components/GridBackground/index.tsx</files>
  <action>
1. **Create src/components/GridBackground/GridBackground.module.css:**

```css
.gridBackground {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  pointer-events: none;
}

.weekendBlock {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--gantt-weekend-background, #fee2e2);
}

.gridLine {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--gantt-day-line-color, #f3f4f6);
}

.monthSeparator {
  width: var(--gantt-month-separator-width, 2px);
  background-color: var(--gantt-month-separator-color, #374151);
}

.weekSeparator {
  width: var(--gantt-week-separator-width, 1px);
  background-color: var(--gantt-week-separator-color, #d1d5db);
}

.dayLine {
  width: var(--gantt-day-line-width, 1px);
  background-color: var(--gantt-day-line-color, #f3f4f6);
}
```

2. **Create src/components/GridBackground/index.tsx:**
```typescript
export { default } from './GridBackground';
export type { GridBackgroundProps } from './GridBackground';
```

Follow CSS variable usage:
- Use var(--gantt-*) for all themeable values
- Provide fallback values matching globals.css defaults

DO NOT:
- Add hover states (grid is not interactive)
- Use fixed colors instead of CSS variables
- Create separate files for exports (use barrel export)
  </action>
  <verify>
npm test passes
TypeScript compilation: npx tsc --noEmit
CSS module imports correctly in component
  </verify>
  <done>
GridBackground.module.css exists with all required classes
CSS variables used for all colors and widths
Barrel export (index.tsx) exists
Styles apply correctly to component
  </done>
</task>

</tasks>

<verification>
Overall verification steps after completing all tasks:

1. Run tests: npm test (all tests pass)
2. TypeScript check: npx tsc --noEmit (no errors)
3. Verify component structure:
   - src/components/GridBackground/GridBackground.tsx exists
   - src/components/GridBackground/GridBackground.module.css exists
   - src/components/GridBackground/index.tsx exists
4. Verify imports work:
   - import GridBackground from '@/components/GridBackground'
5. Manual visual check (if running dev server):
   - Weekend backgrounds are pink
   - Month separators are thick and dark
   - Week separators are visible
   - Grid lines span full height
</verification>

<success_criteria>
- GridBackground component renders vertical lines for all dates in range
- Weekend backgrounds are pink (#fee2e2 or CSS variable)
- Month separators are 2px thick and dark gray (#374151)
- Week separators are 1px thick and medium gray (#d1d5db)
- Day lines are 1px thick and light gray (#f3f4f6)
- Grid lines span full height of task area
- Component is optimized with React.memo
- CSS uses variables for theming
- All existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-calendar/03-02-SUMMARY.md`
</output>
