---
phase: 03-calendar
plan: 03
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - src/components/TimeScaleHeader/TimeScaleHeader.tsx
  - src/components/TimeScaleHeader/TimeScaleHeader.module.css
autonomous: true
requirements:
  - API-03
  - DX-01
  - DX-02
  - DX-03
  - DX-04

must_haves:
  truths:
    - "User can see two-row header with month names on top and day numbers below"
    - "User can see month names in Russian (Январь, Февраль, etc.)"
    - "User can see month cells spanning correct number of days"
    - "Day numbers are centered in their columns"
    - "Month names are left-aligned in their cells"
  artifacts:
    - path: "src/components/TimeScaleHeader/TimeScaleHeader.tsx"
      provides: "Two-row header with month names and day numbers"
      min_lines: 60
    - path: "src/components/TimeScaleHeader/TimeScaleHeader.module.css"
      provides: "Styling for two-row header layout"
      min_lines: 40
  key_links:
    - from: "src/components/TimeScaleHeader/TimeScaleHeader.tsx"
      to: "src/utils/dateUtils.ts"
      via: "getMonthSpans"
      pattern: "getMonthSpans"
    - from: "src/components/TimeScaleHeader/TimeScaleHeader.tsx"
      to: "date-fns"
      via: "format() with Russian locale"
      pattern: "import.*ru.*from 'date-fns/locale'"
    - from: "src/components/TimeScaleHeader/TimeScaleHeader.module.css"
      to: "src/app/globals.css"
      via: "CSS variables for separator styling"
      pattern: "var\\(--gantt-"
---

<objective>
Rewrite TimeScaleHeader to display a two-row header: top row shows month names (Russian, left-aligned), bottom row shows day numbers (centered).

Purpose: Replace the current single-row header (showing "Mon 1") with a hierarchical two-row header that shows months and days separately. This provides better date information density and matches standard Gantt chart patterns.

Output: Two-row header component with month names spanning multiple day columns.
</objective>

<execution_context>
@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-calendar/03-CONTEXT.md
@.planning/phases/03-calendar/03-RESEARCH.md
@.planning/phases/03-calendar/03-01-SUMMARY.md

@src/components/TimeScaleHeader/TimeScaleHeader.tsx
@src/components/TimeScaleHeader/TimeScaleHeader.module.css
@src/utils/dateUtils.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Rewrite TimeScaleHeader for two-row layout</name>
  <files>src/components/TimeScaleHeader/TimeScaleHeader.tsx</files>
  <action>
Completely rewrite src/components/TimeScaleHeader/TimeScaleHeader.tsx:

1. **Update imports:**
```typescript
import React, { useMemo } from 'react';
import { format } from 'date-fns';
import { ru } from 'date-fns/locale';
import { getMonthSpans } from '../../utils/dateUtils';
import type { MonthSpan } from '../../types';
import styles from './TimeScaleHeader.module.css';
```

2. **Update interface:**
```typescript
export interface TimeScaleHeaderProps {
  /** Array of dates to display (from getMultiMonthDays) */
  days: Date[];
  /** Width of each day column in pixels */
  dayWidth: number;
  /** Height of the header row in pixels */
  headerHeight: number;
}
```

3. **Component logic:**
   - Use getMonthSpans(days) to calculate month boundaries
   - Calculate rowHeight = headerHeight / 2 (50/50 split)
   - Render two divs with flexbox layout:
     * Month row: Flex container, month cells with width = days * dayWidth
     * Day row: CSS Grid with repeat(days.length, dayWidth) columns

4. **Month row rendering:**
   - For each span: render div with width = span.days * dayWidth
   - Content: format(span.month, 'MMMM', { locale: ru }) for Russian month name
   - Apply .monthCell class

5. **Day row rendering:**
   - Map over all days in dateRange
   - Render div for each day with content = format(day, 'd')
   - Apply .dayCell class

6. **Styling approach:**
   - Use CSS Modules for all styles
   - Month cells: left-aligned text (text-align: left)
   - Day cells: centered text (text-align: center)
   - Add border-bottom to month row

Remove old single-row logic completely.

DO NOT:
- Keep any of the old "EEE d" format code
- Use English locale (must use Russian: ru)
- Hardcode month names (use date-fns format)
- Use table layout (use flexbox + CSS Grid)
  </action>
  <verify>
npm test passes
TypeScript compilation: npx tsc --noEmit
Component renders without errors
  </verify>
  <done>
Header displays two rows (months on top, days below)
Month names are in Russian (Январь, Февраль, etc.)
Month cells span correct number of days
Day numbers (1, 2, 3...) are centered
Month names are left-aligned
Header height is evenly split between rows
  </done>
</task>

<task type="auto">
  <name>Update TimeScaleHeader CSS for two-row layout</name>
  <files>src/components/TimeScaleHeader/TimeScaleHeader.module.css</files>
  <action>
Completely rewrite src/components/TimeScaleHeader/TimeScaleHeader.module.css:

1. **Header container:**
```css
.header {
  display: flex;
  flex-direction: column;
  background-color: var(--gantt-cell-background);
  border-bottom: var(--gantt-month-separator-width, 2px) solid var(--gantt-month-separator-color, #374151);
  box-sizing: border-box;
}
```

2. **Month row (top):**
```css
.monthRow {
  display: flex;
  border-bottom: var(--gantt-day-line-width, 1px) solid var(--gantt-day-line-color, #f3f4f6);
  align-items: center;
}

.monthCell {
  box-sizing: border-box;
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: #1f2937;
  border-right: var(--gantt-day-line-width, 1px) solid var(--gantt-day-line-color, #f3f4f6);
  text-align: left;
}

.monthCell:last-child {
  border-right: none;
}
```

3. **Day row (bottom):**
```css
.dayRow {
  display: grid;
  box-sizing: border-box;
}

.dayCell {
  display: flex;
  align-items: center;
  justify-content: center;
  border-right: var(--gantt-day-line-width, 1px) solid var(--gantt-day-line-color, #f3f4f6);
  box-sizing: border-box;
}

.dayCell:last-child {
  border-right: none;
}

.dayLabel {
  font-size: 0.75rem;
  font-weight: 500;
  color: #374151;
}
```

Key points:
- Use CSS variables for all colors and widths
- Month row: flexbox for dynamic-width month cells
- Day row: CSS Grid for fixed-width day columns
- Left-align month names, center day numbers
- Border-bottom on month row separates rows

DO NOT:
- Use fixed pixel widths for month cells (calculate dynamically)
- Use text-align: center for month names (must be left-aligned)
- Use flexbox for day row (must use CSS Grid for column alignment)
- Hardcode colors (use CSS variables)
  </action>
  <verify>
npm test passes
Component styles apply correctly visually
  </verify>
  <done>
Month cells use flexbox layout
Day cells use CSS Grid layout
Month names are left-aligned
Day numbers are centered
CSS variables used for all colors
Borders render correctly at month/day boundaries
  </done>
</task>

</tasks>

<verification>
Overall verification steps after completing all tasks:

1. Run tests: npm test (all tests pass)
2. TypeScript check: npx tsc --noEmit (no errors)
3. Verify component structure:
   - TimeScaleHeader.tsx has two-row layout
   - CSS module has .monthRow, .dayRow classes
4. Verify locale import:
   - import { ru } from 'date-fns/locale' is present
5. Manual visual check (if running dev server):
   - Month names in Russian
   - Two rows visible
   - Day numbers centered
   - Month names left-aligned
</verification>

<success_criteria>
- TimeScaleHeader displays two rows (month row + day row)
- Month row shows Russian month names (Январь, Февраль, etc.)
- Day row shows day numbers (1, 2, 3...) without weekday names
- Month cells span correct number of days using flexbox
- Day cells use CSS Grid with explicit column widths
- Month names are left-aligned (text-align: left)
- Day numbers are centered (justify-content: center)
- Header height is evenly split between two rows
- CSS variables used for all colors and widths
- All existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-calendar/03-03-SUMMARY.md`
</output>
