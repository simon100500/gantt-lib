---
phase: 01-foundation-core-rendering
plan: 03
type: execute
wave: 2
depends_on: [01-01, 01-02]
files_modified:
  - src/components/GanttChart/index.tsx
  - src/components/GanttChart/GanttChart.tsx
  - src/components/GanttChart/GanttChart.module.css
  - src/components/TimeScaleHeader/index.tsx
  - src/components/TimeScaleHeader/TimeScaleHeader.tsx
  - src/components/TimeScaleHeader/TimeScaleHeader.module.css
  - src/components/TaskRow/index.tsx
  - src/components/TaskRow/TaskRow.tsx
  - src/components/TaskRow/TaskRow.module.css
  - src/components/TodayIndicator/index.tsx
  - src/components/TodayIndicator/TodayIndicator.tsx
  - src/components/TodayIndicator/TodayIndicator.module.css
  - src/app/page.tsx
autonomous: true
requirements: [REND-01, REND-02, REND-03, REND-04, REND-05, API-01, API-04, DX-05]
must_haves:
  truths:
    - "User sees monthly calendar grid with date headers (REND-01)"
    - "User sees task bars positioned by start/end dates (REND-02)"
    - "User sees task names on task bars (REND-03)"
    - "User sees vertical today indicator line (REND-04)"
    - "User sees Excel-like grid lines and cell styling (REND-05)"
    - "Developer can render tasks via {id, name, startDate, endDate, color?} array (API-01)"
    - "Component uses UTC internally for dates (API-04)"
    - "CSS variables available for color customization (DX-05)"
  artifacts:
    - path: "src/components/GanttChart/GanttChart.tsx"
      provides: "Main Gantt chart component"
      exports: ["GanttChart", "Task"]
      min_lines: 50
    - path: "src/components/TimeScaleHeader/TimeScaleHeader.tsx"
      provides: "Date header row with month/day labels"
      min_lines: 20
    - path: "src/components/TaskRow/TaskRow.tsx"
      provides: "Single task row with bar rendering"
      contains: "React.memo"
      min_lines: 30
    - path: "src/components/TodayIndicator/TodayIndicator.tsx"
      provides: "Vertical today line"
      min_lines: 15
    - path: "src/components/GanttChart/GanttChart.module.css"
      provides: "CSS variables for theming"
      contains: ":root"
  key_links:
    - from: "src/components/GanttChart/GanttChart.tsx"
      to: "src/utils/dateUtils.ts"
      via: "import date utilities"
      pattern: "from.*utils/dateUtils"
    - from: "src/components/GanttChart/GanttChart.tsx"
      to: "src/utils/geometry.ts"
      via: "import geometry functions"
      pattern: "from.*utils/geometry"
    - from: "src/components/TaskRow/TaskRow.tsx"
      to: "src/types/index.ts"
      via: "Task type import"
      pattern: "from.*types"
    - from: "src/components/GanttChart/GanttChart.module.css"
      to: "CSS Variables"
      via: "--gantt-* custom properties"
      pattern: "--gantt-"
---

<objective>
Build the core Gantt chart rendering components with Excel-like styling, CSS variable theming, and UTC-safe date handling.

Purpose: Create the visual layer that displays tasks on a monthly timeline. This implements all rendering requirements (REND-01 through REND-05) and the basic data API (API-01, API-04) with CSS theming (DX-05).

Output: Working static Gantt chart component displaying task bars on a monthly calendar grid with today indicator, using CSS variables for theming.
</objective>

<execution_context>
@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-rendering/01-CONTEXT.md
@.planning/phases/01-foundation-core-rendering/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Create GanttChart main component with CSS theming</name>
  <files>src/components/GanttChart/index.tsx, src/components/GanttChart/GanttChart.tsx, src/components/GanttChart/GanttChart.module.css</files>
  <action>
    Create the root GanttChart component:
    1. Define Task interface: {id: string, name: string, startDate: string|Date, endDate: string|Date, color?: string}
    2. Accept props: tasks, month (default current), dayWidth (default 40), rowHeight (default 40)
    3. Use useMemo to calculate monthDays using getMonthDays from dateUtils
    4. Use useMemo to calculate gridWidth using calculateGridWidth from geometry
    5. Render TimeScaleHeader and TaskRow components
    6. Export Task type for consumer use

    Create GanttChart.module.css:
    1. Define :root CSS variables: --gantt-grid-line-color (#e0e0e0), --gantt-cell-background (#ffffff), --gantt-row-height (40px), --gantt-header-height (40px), --gantt-day-width (40px), --task-bar-default-color (#3b82f6), --task-bar-text-color (#ffffff), --today-indicator-color (#ef4444)
    2. Use CSS Grid for layout with gap for cell borders
    3. Apply system-ui font family
    4. Create Excel-like table styling with explicit borders

    Per CONTEXT.md decision: "Табличный стиль, как будто закрасил в экселе ячейки" — clear cell boundaries are essential.
  </action>
  <verify>
    Component renders without errors, TypeScript compiles, CSS variables are defined
  </verify>
  <done>
    GanttChart component accepts tasks array and renders child components
  </done>
</task>

<task type="auto">
  <name>Create TimeScaleHeader component</name>
  <files>src/components/TimeScaleHeader/index.tsx, src/components/TimeScaleHeader/TimeScaleHeader.tsx, src/components/TimeScaleHeader/TimeScaleHeader.module.css</files>
  <action>
    Create date header component:
    1. Accept props: days (Date[]), dayWidth (number), headerHeight (number)
    2. Render day columns using format() from date-fns with "EEE d" pattern (e.g., "Mon 1", "Tue 2")
    3. Use CSS Grid with explicit column widths matching dayWidth
    4. Add bottom border for separation from task rows
    5. Apply header-height CSS variable

    Claude's discretion per CONTEXT.md: Date format can be "1" or "Mon 1" — use "EEE d" for clarity.

    Create TimeScaleHeader.module.css with grid layout and header styling.
  </action>
  <verify>
    Header renders day labels across the top, columns align with dayWidth
  </verify>
  <done>
    TimeScaleHeader displays day labels in a horizontal row
  </done>
</task>

<task type="auto">
  <name>Create TaskRow component with React.memo</name>
  <files>src/components/TaskRow/index.tsx, src/components/TaskRow/TaskRow.tsx, src/components/TaskRow/TaskRow.module.css</files>
  <action>
    Create task row component:
    1. Accept props: task (Task), monthStart (Date), dayWidth (number), rowHeight (number)
    2. Wrap component in React.memo with custom comparison function (compare id, startDate, endDate, name)
    3. Calculate task bar position using calculateTaskBar from geometry
    4. Render task bar absolutely positioned within row
    5. Display task name inside bar with text-overflow: ellipsis
    6. Apply task.color or use --task-bar-default-color CSS variable
    7. Add horizontal border for row separation (Excel-like grid)

    This satisfies QL-01 requirement (React.memo for performance prevention).

    Create TaskRow.module.css with:
    1. Row styling with relative positioning for absolute task bars
    2. Task bar styling with flex centering, overflow handling, rounded corners
    3. Border-bottom for grid line effect
  </action>
  <verify>
    Task bar appears at correct horizontal position, width spans duration, name is visible
  </verify>
  <done>
    TaskRow renders a single task with bar positioned by dates
  </done>
</task>

<task type="auto">
  <name>Create TodayIndicator component</name>
  <files>src/components/TodayIndicator/index.tsx, src/components/TodayIndicator/TodayIndicator.tsx, src/components/TodayIndicator/TodayIndicator.module.css</files>
  <action>
    Create today indicator component:
    1. Accept props: monthStart (Date), dayWidth (number)
    2. Calculate today's position using getDayOffset from dateUtils and isToday check
    3. Render vertical line at calculated position
    4. Style with --today-indicator-color CSS variable (default #ef4444 red)
    5. Position absolutely to span full height of task area
    6. Only render if today is within current month

    This satisfies REND-04 requirement (vertical indicator for current date).

    Create TodayIndicator.module.css with vertical line styling and positioning.
  </action>
  <verify>
    Vertical red line appears at today's date when viewing current month
  </verify>
  <done>
    TodayIndicator displays vertical line at current date position
  </done>
</task>

<task type="auto">
  <name>Create demo page with sample tasks</name>
  <files>src/app/page.tsx</files>
  <action>
    Update src/app/page.tsx to demonstrate the GanttChart:
    1. Import GanttChart and Task type
    2. Create sample tasks array: 5-7 tasks with varied dates, durations, and colors
    3. Include tasks that: start today, end today, span multiple days, have custom colors
    4. Render GanttChart with sample tasks
    5. Add page title and basic styling
    6. Test DST edge cases (include task crossing DST boundary)

    Sample tasks should demonstrate:
    - Single-day tasks
    - Multi-day tasks
    - Tasks with custom colors
    - Task starting/ending today
  </action>
  <verify>
    Visit http://localhost:3000 — see complete Gantt chart with all components rendering
  </verify>
  <done>
    Demo page displays working Gantt chart with sample tasks
  </done>
</task>

</tasks>

<verification>
1. Run `npm run dev` - dev server starts
2. Visit http://localhost:3000 - see Gantt chart with:
   - Date headers across top
   - Task bars positioned by dates
   - Task names visible on bars
   - Today indicator line
   - Excel-like grid lines
3. Run `npm test` - all utility tests still pass
4. Run `npx tsc --noEmit` - no TypeScript errors
5. Check browser DevTools - CSS variables are defined and can be overridden
</verification>

<success_criteria>
- [ ] Monthly calendar grid displays with date headers (REND-01)
- [ ] Task bars positioned horizontally by start/end dates (REND-02)
- [ ] Task names displayed on task bars (REND-03)
- [ ] Today indicator vertical line visible (REND-04)
- [ ] Excel-like grid lines and cell styling visible (REND-05)
- [ ] Component accepts tasks array with correct API (API-01)
- [ ] All dates use UTC internally (API-04)
- [ ] CSS variables defined for theming (DX-05)
- [ ] React.memo used on TaskRow (QL-01)
- [ ] Demo page shows working example
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-rendering/01-03-SUMMARY.md`
</output>
