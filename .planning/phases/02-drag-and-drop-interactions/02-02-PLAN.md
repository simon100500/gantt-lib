---
phase: 02-drag-and-drop-interactions
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/DragTooltip/index.tsx
  - src/components/DragTooltip/DragTooltip.tsx
  - src/components/DragTooltip/DragTooltip.module.css
  - src/components/TaskRow/TaskRow.tsx
  - src/components/TaskRow/TaskRow.module.css
  - src/components/GanttChart/GanttChart.tsx
  - src/components/index.ts
autonomous: false
requirements:
  - INT-01
  - INT-02
  - INT-04
  - API-02
must_haves:
  truths:
    - "DragTooltip component displays formatted dates during drag operations"
    - "TaskRow uses useTaskDrag hook to enable drag interactions on task bars"
    - "Task bar shows visual feedback during hover (cursor pointer, shadow/opacity change)"
    - "Resize edge markers visible on left and right edges of task bar"
    - "GanttChart accepts onChange prop and passes it to TaskRow"
    - "onChange callback fires only on mouseup (not during drag)"
    - "Parent receives updated tasks array with modified start/end dates"
  artifacts:
    - path: "src/components/DragTooltip/DragTooltip.tsx"
      provides: "Floating date tooltip during drag"
      min_lines: 40
      contains: "position: fixed"
    - path: "src/components/TaskRow/TaskRow.tsx"
      provides: "Interactive task bar with drag/resize"
      contains: "useTaskDrag"
    - path: "src/components/GanttChart/GanttChart.tsx"
      provides: "onChange prop for parent callback"
      contains: "onChange?:"
    - path: "src/components/TaskRow/TaskRow.module.css"
      provides: "Hover and drag visual styles"
      contains: "cursor: grab|ew-resize"
  key_links:
    - from: "src/components/TaskRow/TaskRow.tsx"
      to: "src/hooks/useTaskDrag.ts"
      via: "import { useTaskDrag } from '../../hooks/useTaskDrag'"
      pattern: "useTaskDrag"
    - from: "src/components/TaskRow/TaskRow.tsx"
      to: "src/components/DragTooltip/DragTooltip.tsx"
      via: "Conditional render during isDragging"
      pattern: "DragTooltip"
    - from: "src/components/GanttChart/GanttChart.tsx"
      to: "src/components/TaskRow/TaskRow.tsx"
      via: "Pass onChange prop to TaskRow"
      pattern: "onChange="
---

# Plan 02-02: Move and Resize Interaction Handlers

## Objective

Integrate the `useTaskDrag` hook into TaskRow component to enable interactive drag-and-drop. Create DragTooltip component for visual date feedback during drag. Add onChange callback to GanttChart to notify parent of task modifications. Implement visual styles for hover states and resize edge markers.

**Purpose:** Enable users to drag task bars to change dates and drag edges to resize duration, with real-time visual feedback and date tooltips.

**Output:** Fully interactive task bars with move/resize functionality, date tooltip, onChange callback, and visual feedback styles.

## Execution Context

@C:/Users/Volobuev/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Volobuev/.claude/get-shit-done/templates/summary.md

## Context

@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-drag-and-drop-interactions/02-CONTEXT.md
@.planning/phases/02-drag-and-drop-interactions/02-RESEARCH.md
@.planning/phases/02-drag-and-drop-interactions/02-01-PLAN.md
@.planning/phases/01-foundation-core-rendering/01-03-SUMMARY.md

@src/components/TaskRow/TaskRow.tsx
@src/components/GanttChart/GanttChart.tsx
@src/hooks/useTaskDrag.ts
@src/utils/geometry.ts

## Tasks

<task type="auto">
  <name>Task 1: Create DragTooltip component</name>
  <files>src/components/DragTooltip/index.tsx, src/components/DragTooltip/DragTooltip.tsx, src/components/DragTooltip/DragTooltip.module.css</files>
  <action>
    Create DragTooltip component that displays formatted dates during drag operations. The tooltip follows cursor position and shows start/end dates.

    DragTooltip.tsx requirements:
    - Interface: `x, y, startDate, endDate, locale?: string` props
    - Use position: fixed for cursor-following behavior
    - Offset: 16px from cursor (x + 16, y + 16)
    - z-index: 1000 to appear above all elements
    - Use date-fns format() with 'd MMMM' pattern (e.g., "15 February")
    - Show start date, arrow (→), end date in vertical layout
    - Locale: default to 'en-US', support other locales via prop

    DragTooltip.module.css requirements:
    - Background: white or light gray with border
    - Padding: 8px 12px
    - Border radius: 4px
    - Box shadow: 0 2px 8px rgba(0,0,0,0.15)
    - Font size: 14px
    - Color: var(--gantt-task-bar-text-color) or #333
    - Date row: centered text
    - Arrow: centered, light gray color

    Per user decision: Use full date format (e.g., "15 февраля" or "February 15") for readability.
    Per Claude's discretion: Use 16px offset, white background, standard box shadow.

    DO NOT implement edge-flipping logic when near viewport edges (deferred to future enhancement).
  </action>
  <verify>TypeScript compilation succeeds; DragTooltip component exports from index.tsx</verify>
  <done>DragTooltip component created with fixed positioning, date formatting, and styling</done>
</task>

<task type="auto">
  <name>Task 2: Add drag visual styles to TaskRow CSS</name>
  <files>src/components/TaskRow/TaskRow.module.css</files>
  <action>
    Add CSS classes for hover states, drag states, and resize edge markers to TaskRow.module.css.

    Add these styles:

    1. Task bar hover state (.taskBar:hover):
       - cursor: grab (per user decision)
       - box-shadow: 0 2px 4px rgba(0,0,0,0.2) OR opacity: 0.9 (Claude's discretion - use shadow for "tangible" feel per user idea)
       - transition: box-shadow 0.15s ease

    2. Active drag state (.taskBar.dragging):
       - cursor: grabbing
       - box-shadow: 0 4px 12px rgba(0,0,0,0.3)
       - opacity: 1 (solid appearance per user decision)
       - transition: none (disable transitions during drag for performance)

    3. Resize edge markers (.resizeHandle):
       - Position: absolute on left/right edges
       - Width: 2px (visible marker per user decision)
       - Height: 100% of task bar
       - Background: rgba(255,255,255,0.4) (lighter than task bar)
       - Cursor: ew-resize
       - Left handle: left: 0
       - Right handle: right: 0

    4. Resize zone hint (.taskBar.resizeZoneLeft, .taskBar.resizeZoneRight):
       - Cursor: ew-resize (priority over grab per user decision)

    Per user decision: Resize has priority over move when cursor is on edge zone.
    Per Claude's discretion: Use 2px vertical bars with rgba(255,255,255,0.4) color for markers.

    Use existing CSS variables from GanttChart where possible.
  </action>
  <verify>CSS Module compiles without errors; styles reference existing CSS variables</verify>
  <done>TaskRow.module.css contains hover, drag, and resize handle styles</done>
</task>

<task type="auto">
  <name>Task 3: Integrate useTaskDrag hook into TaskRow component</name>
  <files>src/components/TaskRow/TaskRow.tsx, src/components/GanttChart/GanttChart.tsx, src/components/index.ts</files>
  <action>
    Integrate the useTaskDrag hook into TaskRow to enable drag interactions. Pass onChange from GanttChart to TaskRow. Add resize edge markers to task bar. Conditionally render DragTooltip during drag.

    TaskRow.tsx changes:
    1. Import useTaskDrag from '../../hooks/useTaskDrag'
    2. Add onChange prop to TaskRowProps interface: `onChange?: (updatedTask: Task) => void`
    3. Call useTaskDrag hook with:
       - taskId: task.id
       - initialStartDate: taskStartDate (from useMemo)
       - initialEndDate: taskEndDate (from useMemo)
       - monthStart, dayWidth from props
       - onDragEnd: call onChange with updated task object
       - edgeZoneWidth: 12 (default)
    4. Apply dragHandleProps to task bar element (onMouseDown, style)
    5. Add conditional DragTooltip render when isDragging is true
    6. Add resize handle divs (.resizeHandle) at left/right edges
    7. Apply dragging class when isDragging is true
    8. Update React.memo comparison to include onChange prop

    GanttChart.tsx changes:
    1. Add onChange prop to GanttChartProps interface: `onChange?: (tasks: Task[]) => void`
    2. Pass onChange prop to each TaskRow
    3. In TaskRow onDragEnd, create updated tasks array and call onChange

    onDragEnd implementation in TaskRow:
    ```typescript
    const handleDragEnd = (result: { id: string; startDate: Date; endDate: Date }) => {
      const updatedTask: Task = {
        ...task,
        startDate: result.startDate.toISOString(),
        endDate: result.endDate.toISOString(),
      };
      props.onChange?.(updatedTask);
    };
    ```

    IMPORTANT: onChange fires only on drop (mouseUp), not during drag (per user decision).
    IMPORTANT: Other tasks don't react during drag (no highlighting).
    IMPORTANT: Visual updates happen in real-time during drag (via hook's currentLeft/currentWidth).
  </action>
  <verify>TypeScript compilation succeeds with no errors; GanttChart exports from src/components/index.ts</verify>
  <done>TaskRow integrated with useTaskDrag, resize markers added, DragTooltip conditionally rendered, onChange callback wired</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete drag-and-drop interactions with DragTooltip, visual feedback, and onChange callback</what-built>
  <how-to-verify>
    1. Start dev server: npm run dev
    2. Open http://localhost:3000
    3. Test move: Click and drag center of task bar, verify it moves smoothly
    4. Test resize: Click and drag left/right edge, verify edge resizes
    5. Verify snap: Task should snap to day boundaries (not partial pixels)
    6. Verify tooltip: Date tooltip appears during drag with correct dates
    7. Verify hover: Cursor changes to grab on hover, ew-resize on edges
    8. Verify shadow: Task bar has shadow during hover/drag (tangible feel)
    9. Verify onChange: Open browser console, drag task, check if onChange fires
    10. Verify minimum width: Try to resize below 1 day, should stop at minimum
  </how-to-verify>
  <resume-signal>Type "approved" if drag/resize works correctly, or describe issues to fix</resume-signal>
</task>

## Verification

Run these checks after checkpoint approval:
1. TypeScript compilation: `npx tsc --noEmit` - must have no errors
2. Build succeeds: `npm run build` - production build completes
3. Dev server runs: `npm run dev` - server starts on port 3000
4. All tests pass: `npm test` - existing tests still pass
5. Component exports: `grep -r "DragTooltip" src/components/index.ts` - tooltip exported

## Success Criteria

- [ ] DragTooltip component created with fixed positioning and date formatting
- [ ] TaskRow uses useTaskDrag hook for drag interactions
- [ ] Task bar shows grab cursor on hover, ew-resize on edges
- [ ] Visual feedback: shadow during hover/drag (tangible feel)
- [ ] Resize edge markers visible on left/right edges (2px light bars)
- [ ] Drag/resize operations snap to day boundaries
- [ ] Date tooltip shows during drag with full format
- [ ] onChange callback fires only on mouseup (not during drag)
- [ ] Minimum 1-day width enforced during resize
- [ ] React.memo updated to include onChange prop
- [ ] Human verification confirms smooth 60fps drag interaction

## Output

After completion, create `.planning/phases/02-drag-and-drop-interactions/02-02-SUMMARY.md` following the summary template.
